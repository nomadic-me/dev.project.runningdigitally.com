{% extends "base2.html" %}

{% block head %}
{{super()}}
    <script>
        async function callback_portfolio() {
            let Period = '5y';
            let Interval = '1d';
            let Portfolio = document.getElementById('portfolio').value;
            if (Portfolio == 'Portfolio1') {
                let Stock1 = 'BNS.TO';
                let Stock2 = 'UBER';
                let Stock3 = 'TSLA';
                alert("Selected Portfolio is: " + Portfolio + " with the following Stocks " + Stock1 + ", " + Stock2 + ", " + Stock3 + ". \n\nPlease allow for upto 60 secs for the data to load");
                
            let response1 = await fetch("/callback2/getStock?data=" + Stock1 + "&period=" + Period + "&interval=" + Interval);    
            let response2 = await fetch("/callback2/getStock?data=" + Stock2 + "&period=" + Period + "&interval=" + Interval);
            let response3 = await fetch("/callback2/getStock?data=" + Stock3 + "&period=" + Period + "&interval=" + Interval);
            
            if (response1.ok) {
                let chartJson1 = await response1.json();
                if (response1.ok) {
                    response1 = await fetch("/callback2/getInfo?data=" + Stock1);
                    let infoJson1 = await response1.json();
                    info1(infoJson1);
                    Plotly.newPlot('chart1', chartJson1, {});
                } else {
                    alert("HTTP-Error: " + response1.status + "on getInfo");
                }
            } else {
                alert("HTTP-Error: " + response1.status + "on getStock");
            }
            if (response2.ok) {
                let chartJson2 = await response2.json();
                if (response2.ok) {
                    response2 = await fetch("/callback2/getInfo?data=" + Stock2);
                    let infoJson2 = await response2.json();
                    info2(infoJson2);
                    Plotly.newPlot('chart2', chartJson2, {});
                } else {
                    alert("HTTP-Error: " + response2.status + "on getInfo");
                }
            } else {
                alert("HTTP-Error: " + response2.status + "on getStock");
            }

            if (response3.ok) {
                let chartJson3 = await response3.json();
                if (response3.ok) {
                    response3 = await fetch("/callback2/getInfo?data=" + Stock3);
                    let infoJson3 = await response3.json();
                    info3(infoJson3);
                    Plotly.newPlot('chart3', chartJson3, {});
                } else {
                    alert("HTTP-Error: " + response3.status + "on getInfo");
                }
            } else {
                alert("HTTP-Error: " + response3.status + "on getStock");
            }
            }
            
            if (Portfolio == 'Portfolio2') {
                let Stock1 = 'TWTR';
                let Stock2 = 'ZDV.TO';
                let Stock3 = 'ZEB.TO';    
                alert("Selected Portfolio is: " + Portfolio + " with the following Stocks " + Stock1 + ", " + Stock2 + ", " + Stock3 + ". \n\nPlease allow for upto 60 secs for the data to load");                
                let response1 = await fetch("/callback2/getStock?data=" + Stock1 + "&period=" + Period + "&interval=" + Interval);    
            let response2 = await fetch("/callback2/getStock?data=" + Stock2 + "&period=" + Period + "&interval=" + Interval);
            let response3 = await fetch("/callback2/getStock?data=" + Stock3 + "&period=" + Period + "&interval=" + Interval);
            
            if (response1.ok) {
                let chartJson1 = await response1.json();
                if (response1.ok) {
                    response1 = await fetch("/callback2/getInfo?data=" + Stock1);
                    let infoJson1 = await response1.json();
                    info1(infoJson1);
                    Plotly.newPlot('chart1', chartJson1, {});
                } else {
                    alert("HTTP-Error: " + response1.status + "on getInfo");
                }
            } else {
                alert("HTTP-Error: " + response1.status + "on getStock");
            }
            if (response2.ok) {
                let chartJson2 = await response2.json();
                if (response2.ok) {
                    response2 = await fetch("/callback2/getInfo?data=" + Stock2);
                    let infoJson2 = await response2.json();
                    info2(infoJson2);
                    Plotly.newPlot('chart2', chartJson2, {});
                } else {
                    alert("HTTP-Error: " + response2.status + "on getInfo");
                }
            } else {
                alert("HTTP-Error: " + response2.status + "on getStock");
            }

            if (response3.ok) {
                let chartJson3 = await response3.json();
                if (response3.ok) {
                    response3 = await fetch("/callback2/getInfo?data=" + Stock3);
                    let infoJson3 = await response3.json();
                    info3(infoJson3);
                    Plotly.newPlot('chart3', chartJson3, {});
                } else {
                    alert("HTTP-Error: " + response3.status + "on getInfo");
                }
            } else {
                alert("HTTP-Error: " + response3.status + "on getStock");
            }
                
            }

            if (Portfolio == 'Portfolio3') {
                let Stock1 = 'PG';
                let Stock2 = 'WSRD.TO';
                let Stock3 = 'SPY';        
                alert("Selected Portfolio is: " + Portfolio + " with the following Stocks " + Stock1 + ", " + Stock2 + ", " + Stock3 + ". \n\nPlease allow for upto 60 secs for the data to load");                
                let response1 = await fetch("/callback2/getStock?data=" + Stock1 + "&period=" + Period + "&interval=" + Interval);    
            let response2 = await fetch("/callback2/getStock?data=" + Stock2 + "&period=" + Period + "&interval=" + Interval);
            let response3 = await fetch("/callback2/getStock?data=" + Stock3 + "&period=" + Period + "&interval=" + Interval);
            
            if (response1.ok) {
                let chartJson1 = await response1.json();
                if (response1.ok) {
                    response1 = await fetch("/callback2/getInfo?data=" + Stock1);
                    let infoJson1 = await response1.json();
                    info1(infoJson1);
                    Plotly.newPlot('chart1', chartJson1, {});
                } else {
                    alert("HTTP-Error: " + response1.status + "on getInfo");
                }
            } else {
                alert("HTTP-Error: " + response1.status + "on getStock");
            }
            if (response2.ok) {
                let chartJson2 = await response2.json();
                if (response2.ok) {
                    response2 = await fetch("/callback2/getInfo?data=" + Stock2);
                    let infoJson2 = await response2.json();
                    info2(infoJson2);
                    Plotly.newPlot('chart2', chartJson2, {});
                } else {
                    alert("HTTP-Error: " + response2.status + "on getInfo");
                }
            } else {
                alert("HTTP-Error: " + response2.status + "on getStock");
            }

            if (response3.ok) {
                let chartJson3 = await response3.json();
                if (response3.ok) {
                    response3 = await fetch("/callback2/getInfo?data=" + Stock3);
                    let infoJson3 = await response3.json();
                    info3(infoJson3);
                    Plotly.newPlot('chart3', chartJson3, {});
                } else {
                    alert("HTTP-Error: " + response3.status + "on getInfo");
                }
            } else {
                alert("HTTP-Error: " + response3.status + "on getStock");
            }
            }
            

            
        }
        
        function info1(json) {
            let name = document.getElementById('companyName1');
            name.innerHTML = json.shortName;
            name = document.getElementById('symbol1');
            name.innerHTML = json.symbol;
            name = document.getElementById('dayHigh1');
            name.innerHTML = json.dayHigh;
            name = document.getElementById('dayLow1');
            name.innerHTML = json.dayLow;
            name = document.getElementById('52WeekHigh1');
            name.innerHTML = json.fiftyTwoWeekHigh;            
            name = document.getElementById('52WeekLow1');
            name.innerHTML = json.fiftyTwoWeekLow;
            if (json.beta) {
                name = document.getElementById('beta1');
                name.innerHTML = json.beta;            
            }
            else
            {
                name = document.getElementById('beta1');
                name.innerHTML = json.beta3Year;    
            }   
        }
        
        function info2(json) {
            let name = document.getElementById('companyName2');
            name.innerHTML = json.shortName;
            name = document.getElementById('symbol2');
            name.innerHTML = json.symbol;
            name = document.getElementById('dayHigh2');
            name.innerHTML = json.dayHigh;
            name = document.getElementById('dayLow2');
            name.innerHTML = json.dayLow;
            name = document.getElementById('52WeekHigh2');
            name.innerHTML = json.fiftyTwoWeekHigh;            
            name = document.getElementById('52WeekLow2');
            name.innerHTML = json.fiftyTwoWeekLow;
            if (json.beta) {
                name = document.getElementById('beta2');
                name.innerHTML = json.beta;            
            }
            else
            {
                name = document.getElementById('beta2');
                name.innerHTML = json.beta3Year;    
            }              
        }
        
        function info3(json) {
            let name = document.getElementById('companyName3');
            name.innerHTML = json.shortName;
            name = document.getElementById('symbol3');
            name.innerHTML = json.symbol;
            name = document.getElementById('dayHigh3');
            name.innerHTML = json.dayHigh;
            name = document.getElementById('dayLow3');
            name.innerHTML = json.dayLow;
            name = document.getElementById('52WeekHigh3');
            name.innerHTML = json.fiftyTwoWeekHigh;            
            name = document.getElementById('52WeekLow3');
            name.innerHTML = json.fiftyTwoWeekLow;
            if (json.beta) {
                name = document.getElementById('beta3');
                name.innerHTML = json.beta;            
            }
            else
            {
                name = document.getElementById('beta3');
                name.innerHTML = json.beta3Year;    
            }   
        }        
                async function callback() {
            let Stock = document.getElementById('stock').value;
            let Period = document.getElementById('period').value;
            let Interval = document.getElementById('interval').value;
            let response = await fetch("/callback2/getStock?data=" + Stock + "&period=" + Period + "&interval=" + Interval);
            if (response.ok) {
                let chartJson = await response.json();
                if (response.ok) {
                    response = await fetch("/callback2/getInfo?data=" + Stock);
                    let infoJson = await response.json();
                    info(infoJson);
                    Plotly.newPlot('chart', chartJson, {});
                } else {
                    alert("HTTP-Error: " + response.status + "on getInfo");
                }
            } else {
                alert("HTTP-Error: " + response.status + "on getStock");
            }
        }
        function info(json) {
            let name = document.getElementById('companyName');
            name.innerHTML = json.shortName;
            name = document.getElementById('symbol');
            name.innerHTML = json.symbol;
            name = document.getElementById('dayHigh');
            name.innerHTML = json.dayHigh;
            name = document.getElementById('dayLow');
            name.innerHTML = json.dayLow;
            name = document.getElementById('52WeekHigh');
            name.innerHTML = json.fiftyTwoWeekHigh;            
            name = document.getElementById('52WeekLow');
            name.innerHTML = json.fiftyTwoWeekLow;
        }
    </script>
{% endblock %}

{% block content %}

<h1>Hi, Welcome to "A Look On Millennial Investing"</h1>

<div class="container">
    <div class="row">
            <div class="col text-light bg-dark" style="margin:20px 0px 20px 0px">
                <h2 style="padding:20px 0px 20px 0px">Portfolio Graphs</h2>
            </div>
    </div>
    <div class="row">
        <div class="col-9">
                <select id="portfolio" class="form-select" aria-label="Select" )>
                    <option selected value="Portfolio1">Portfolio 1: Low Risk (Beta < 1): BNS.TO, UBER, TSLA</option>
                    <option value="Portfolio2">Portfolio 2: Balanced Risk:  (Beta ~ 1): TWTR, ZDV.TO, ZEB.TO</option>
                    <option value="Portfolio3">Portfolio 3: High Risk: (Beta > 1): PG, WSRD.TO, SPY</option>                                    
                </select>
        </div>
        <div class="col-3">
                <button type="button" class="btn btn-primary" onclick="callback_portfolio()">Fetch Portfolio</button>
        </div>
    </div>
    <div class="row">
        <div class="row">
            <div class="col-3"><p><b>Stock info 1</b></p>
                <p>Symbol: <span id="symbol1">N/A</span></p>
                <p>Day High: <span id="dayHigh1">N/A</span></p>
                <p>Day Low: <span id="dayLow1">N/A</span></p> 
                <p>52-Week High: <span id="52WeekHigh1">N/A</span></p>
                <p>52-Week Low: <span id="52WeekLow1">N/A</span></p> 
                <p class="hovertext" data-hover="Beta is a concept that measures the expected move in a stock relative to movements in the overall market.">Beta: <span id="beta1">N/A</span></p>                
            </div>
            <div class="col-9">
                <h2 id="companyName1"></h2>
                <div id="chart1" class="chart" style="height: 300px;border: 1px solid; 
                    box-shadow: 5px 5px 5px #888888;">
                    <br>
                </div>
            </div>  
        </div>
        <div class="row">
            <div class="col-3"><p><b>Stock info 2</b></p>
                <p>Symbol: <span id="symbol2">N/A</span></p>
                <p>Day High: <span id="dayHigh2">N/A</span></p>
                <p>Day Low: <span id="dayLow2">N/A</span></p> 
                <p>52-Week High: <span id="52WeekHigh2">N/A</span></p>
                <p>52-Week Low: <span id="52WeekLow2">N/A</span></p>                
                <p class="hovertext" data-hover="Beta is a concept that measures the expected move in a stock relative to movements in the overall market.">Beta: <span id="beta2">N/A</span></p>
            </div>
            <div class="col-9">
                <h2 id="companyName2"></h2>
                <div id="chart2" class="chart" style="height: 300px;border: 1px solid; 
                    box-shadow: 5px 5px 5px #888888;">
                <br>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-3"><p><b>Stock info 3</b></p>
                <p>Symbol: <span id="symbol3">N/A</span></p>
                <p>Day High: <span id="dayHigh3">N/A</span></p>
                <p>Day Low: <span id="dayLow3">N/A</span></p> 
                <p>52-Week High: <span id="52WeekHigh3">N/A</span></p>
                <p>52-Week Low: <span id="52WeekLow3">N/A</span></p> 
                <p class="hovertext" data-hover="Beta is a concept that measures the expected move in a stock relative to movements in the overall market.">Beta: <span id="beta3">N/A</span></p>                
            </div>
            <div class="col-9">
                <h2 id="companyName3"></h2>
                <div id="chart3" class="chart" style="height: 300px;border: 1px solid; 
                    box-shadow: 5px 5px 5px #888888;">
                <br>


                </div>
            </div>
        </div>
    </div>
    <div class="row">            
        <div class="col-12" style="font-size:smaller;padding:10px;text-align: right;">
                <i>The data is, to the best of our knowledge, correct but cannot be guarenteed to be so</i>
                <br/>
                <i>This site is for educational and demonstation purposes, only</i>
            </div>    
    </div>

</div>


    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-gtEjrD/SeCtmISkJkNUaaKMoLD0//ElJ19smozuHV6z3Iehds+3Ulb9Bn9Plx0x4"
        crossorigin="anonymous"></script>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>

{% endblock %}
